<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.school.dao.CourseMapper">
	<resultMap type="com.school.pojo.Course" id="BaseResultMap">
		<id property="cno" column="cno" javaType="int" jdbcType="INTEGER"/>
		<result property="cname" column="cname" javaType="string" jdbcType="VARCHAR"/>
	</resultMap>
	<resultMap type="com.school.pojo.Course" id="TeacherResultMap" extends="BaseResultMap">
		<collection property="teachers" ofType="com.school.pojo.Teachers">
			<id property="tno" column="tno" javaType="int" jdbcType="INTEGER"/>
			<result property="tname" column="tname" javaType="string" jdbcType="VARCHAR"/>
		</collection>
	</resultMap>
	<resultMap type="com.school.pojo.Course" id="ClassResultMap" extends="BaseResultMap">
		<collection property="classes" ofType="com.school.pojo.Classes">
			<id property="id" column="id" javaType="int" jdbcType="INTEGER"/>
			<result property="classname" column="classname" javaType="string" jdbcType="VARCHAR"/>
		</collection>
	</resultMap>
	
	<select id="getCourseById" resultMap="BaseResultMap" parameterType="java.lang.Integer">
		select c.cname from course c where c.cno=#{c.cno,jdbcType=INTEGER}
	</select>
	<select id="getCourseTeachers" resultMap="TeacherResultMap" parameterType="java.lang.Integer">
		select c.cname,t.tname from
		course c
		inner join
		teacher_course tc
		on c.cno=tc.course_cno
		inner join
		teachers t
		on tc.teacher_tno=t.tno
		where c.cno=#{c.cno,jdbcType=INTEGER};
	</select>
	
	<select id="getCourses" resultMap="BaseResultMap">
 		select
 			cno,cname
 		from
 			course 
 		group by cname
	</select>
	<insert id="addCourse" parameterType="com.school.pojo.Course">
		insert into course
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="cname !=null">cname,</if>
			tno
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="cname !=null">#{cname,jdbcType=VARCHAR},</if>
			#{tno,jdbcType=INTEGER}
		</trim>
	</insert>
	<delete id="deleteCourse" parameterType="java.lang.String">
		delete from course
		where cname=#{cname,jdbcType=VARCHAR}
	</delete>
	<update id="updateCourse" parameterType="com.school.pojo.Course">
		update course
		<set>
			<if test="cname!=null">
				cname=#{cname,jdbcType=VARCHAR},
			</if>
		</set>
		where cname= #{cname,jdbcType=VARCHAR}
	</update>
</mapper>
